#!/bin/bash
( samtools view -H ${1} | grep '^@RG'; /net/shendure/vol1/home/mkircher/bin/bwa_new mem -L 80 -M -C  /net/shendure/vol1/home/mkircher/regulatory_tests/sat_mutagenesis/test2/reference/reference.fa <( /net/shendure/vol1/home/mkircher/bin/samtools view -F pf ${1} | awk 'BEGIN{ OFS="\n"; FS="\t" }{ helper = ""; for (i=12; i <= NF; i++) { helper = helper""$i"\t"}; sub("\t$","",helper); print "@"$1" "helper,$10,"+",$11 }'); /net/shendure/vol1/home/mkircher/bin/bwa_new mem -L 80 -M -C /net/shendure/vol1/home/mkircher/regulatory_tests/sat_mutagenesis/test2/reference/reference.fa <( /net/shendure/vol1/home/mkircher/bin/samtools view -f _1 ${1} | awk 'BEGIN{ OFS="\n"; FS="\t" }{ helper = ""; for (i=12; i <= NF; i++) { helper = helper""$i"\t"}; sub("\t$","",helper); print "@"$1" "helper,$10,"+",$11 }') <( /net/shendure/vol1/home/mkircher/bin/samtools view -f _2 ${1} | awk 'BEGIN{ OFS="\n"; FS="\t" }{ helper = ""; for (i=12; i <= NF; i++) { helper = helper""$i"\t"}; sub("\t$","",helper); print "@"$1" "helper,$10,"+",$11 }') | grep -v "^@" ) | samtools view -Su - | /net/shendure/vol1/home/mkircher/bin/samtools sort - aligned_${1/.bam/}
